<!-- 用户管理 -->
<div>
	<span style="color: grey; display: inline-block;">用户管理></span>
	<!-- 按钮组 -->
	<div class="btns-div">
		<button type="button" class="btn btn-success" id="to-add">新增</button>
		<!-- <button type="button" class="btn btn-danger" id="to-delete">删除所选项</button> -->
	</div>
	<!-- 页面显示区 -->
	<div class="user" style=" height: 555px; overflow-y: scroll;">
		
	</div>
	
	
	<!-- 后台数据显示 -->
	<!-- <div class="col-sm-4 model pull-left" id="myModal">
		<div class="thumbnail">
			<img style="width: 150px;height: 150px;" src="image/3.png" class="img-circle" alt="图片找不到了">
			<div class="caption">
				<div class="row">
					<div class="col-sm-4 col-sm-offset-1">用户名</div>
					<div class="col-sm-7">66666</div>
				</div>
				<div class="row">
					<div class="col-sm-4 col-sm-offset-1">真实姓名</div>
					<div class="col-sm-7">666</div>
				</div>
				<div class="row">
					<div class="col-sm-4 col-sm-offset-1">注册时间</div>
					<div class="col-sm-7">2019-08-11 16:20:25.0</div>
				</div>
				<div class="row">
					<div class="col-sm-4 col-sm-offset-1">email</div>
					<div class="col-sm-7">666</div>
				</div>
				<div class="row">
					<div class="col-sm-4 col-sm-offset-1">状态</div>
					<div class="col-sm-4 ">
						<select class="form-control">
							<option value="false" >禁用</option>
							<option value="true" >启用</option>
							<option value="checked" >选中</option>
						</select>
					</div>
				</div>
			</div>
		</div>
	</div> -->
	
	<!-- 模态框：添加数据 -->
	<div class="modal fade" id="modalAdd">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					
					<button class="btn btn-default close" data-dismiss="modal">&times;</button>
					<span class="modal-title">添加用户</span>
				</div>
				<div class="modal-body">
					<!-- 录入信息的表单 -->
					<form action="" class="form-horizontal">
						<!-- 用户名称 -->
						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">用户名:</label>
							<div class="col-sm-10 ">
								<input id="username" type="text" class="form-control">
							</div>
						</div>
						
						<!-- 密码 -->
						<div class="form-group">
							<label for="password" class="col-sm-2 control-label">密码:</label>
							<div class="col-sm-10 ">
								<input id="password" type="password" class="form-control">
							</div>
						</div>
						
						<!-- 确认密码 -->
						<div class="form-group">
							<label for="passwordQd" class="col-sm-2 control-label">密码:</label>
							<div class="col-sm-10 ">
								<input id="passwordQd" type="password" class="form-control">
							</div>
						</div>
						
						<!-- 真实姓名 -->
						<div class="form-group">
							<label for="nickname" class="col-sm-2 control-label">用户名:</label>
							<div class="col-sm-10 ">
								<input id="nickname" type="text" class="form-control">
							</div>
						</div>
						
						<!-- 邮箱 -->
						<div class="form-group">
							<label for="email" class="col-sm-2 control-label">邮箱:</label>
							<div class="col-sm-10 ">
								<input id="email" type="text" class="form-control">
							</div>
						</div>
						
					</form>
				</div>
				<div class="modal-footer" >
					<button class="btn btn-default" data-dismiss="modal">取消</button>
					<button type="button" class="btn btn-primary btn-default" id="to-save" data-container="body" data-toggle="popover" data-placement="top" data-content="亲,请输入完整的信息呢">保存</button>
					
				</div>
		
			</div>
		</div>
	</div>
	
	<!-- 修改信息 -->
	<div class="modal fade" id="modalChange">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					
					<button class="btn btn-default close" data-dismiss="modal">&times;</button>
					<span class="modal-title">修改用户信息</span>
				</div>
				<div class="modal-body">
					<!-- 录入信息的表单 -->
					<form action="" class="form-horizontal">
						<!-- 用户名称 -->
						<div class="form-group">
							<label for="username" class="col-sm-2 control-label">用户名:</label>
							<div class="col-sm-10 ">
								<input id="username1" type="text" class="form-control">
							</div>
						</div>
						
						<!-- 密码 -->
						<div class="form-group">
							<label for="password" class="col-sm-2 control-label">密码:</label>
							<div class="col-sm-10 ">
								<input id="password1" type="password" class="form-control">
							</div>
						</div>
						
						<!-- 确认密码 -->
						<div class="form-group">
							<label for="passwordQd" class="col-sm-2 control-label">密码:</label>
							<div class="col-sm-10 ">
								<input id="passwordQd1" type="password" class="form-control">
							</div>
						</div>
						
						<!-- 真实姓名 -->
						<div class="form-group">
							<label for="nickname" class="col-sm-2 control-label">用户名:</label>
							<div class="col-sm-10 ">
								<input id="nickname1" type="text" class="form-control">
							</div>
						</div>
						
						<!-- 邮箱 -->
						<div class="form-group">
							<label for="email" class="col-sm-2 control-label">邮箱:</label>
							<div class="col-sm-10 ">
								<input id="email1" type="text" class="form-control">
							</div>
						</div>
						
					</form>
				</div>
				<div class="modal-footer" >
					<button class="btn btn-default" data-dismiss="modal">取消</button>
					<button type="button" class="btn btn-primary btn-default" id="to-save1" data-container="body" data-toggle="popover" data-placement="top" data-content="亲,请输入完整的信息呢">修改</button>
					
				</div>
		
			</div>
		</div>
	</div>
	
</div>

<script>
	findAllUser();
	
	// 修改信息
	$('.user').on('click','#to-change',function(e){
		id = e.target.value;
		getAjax('manager/user/findAllUser','get',null,function(res){
			// console.log(res.data);
			res.data.forEach(function(item){
				console.log(item);
				regTime = item.regTime;
				if(item.id == id){
					$('#username1').val(item.username);
					$('#password1').val(item.password);
					$('#passwordQd1').val(null);
					$('#nickname1').val(item.nickname);
					$('#email1').val(item.email);
					$('#modalChange').modal('show');
				}
			})
		},function(error){})
		// console.log(id);
	});
	
	// 保存修改的信息
	$('#to-save1').click(function(){
		var username = $('#username1').val();
		var password = $('#password1').val();
		var passwordQd = $('#passwordQd1').val();
		var nickname = $('#nickname1').val();
		var email = $('#email1').val();
		
		var re=/^([a-z]|[0-9]){3,12}@([a-z]|[0-9]){2,10}\.[a-z]{3,5}$/ig;
		if(password == passwordQd){
			if(re.test(email)){
				var obj = {
					id:id,
					username:username,
					password:password,
					nickname:nickname,
					email:email,
					regTime:regTime
				}
				console.log(obj);
				saveOrUpdateUser(obj);
				alert('修改成功');
				$('#modalChange').modal('hide');
			}else{
				alert('邮箱格式错误,请重新输入');
				$('#email').val(null);
			}
			
		}else{
			alert('两次输入的密码不一致，请重新输入');
			$('#passwordQd').val(null);
		}
	})
	
	// 点击删除
	$('.user').on('click','#to-delete',function(e){
		// console.log(e.target);
		var id = e.target.value;
		// console.log(id);
		deleteUserById({id:id});
	})
	
	//删除用户方法
	 function deleteUserById(obj){
		 getAjax('manager/user/deleteUserById','get',obj,function(res){
			 alert('删除成功');
			 findAllUser();
		 },function(error){
			 console.log(error)
		 })
	 }
	
	
	
	 // 点击修改用户状态
	var obj = {};
	$(".user").on('click', '#select option', function (e) {
		// console.log($('#select option').val());
		// console.log(e.target.id);
		var id =  Number(e.target.id) ;
		var status = e.target.value;
		if(status === 'false'){
			status == Boolean(false);
		}else{
			status == Boolean(true);
		}
		var obj1 = {
			id:id,
			status:status
		}
		console.log(obj1);
		changeStatus(obj1);
	});
	
	
	// 修改用户状态
	function changeStatus(obj){
		getAjax('manager/user/changeStatus','POST',obj,function(res){
			alert('修改成功');
			findAllUser();
		},function(error){
			console.log(error)
		})
	}
	
	
	
	// 新增一个用户(点击出现输入数据模态框)
	$('#to-add').click(function(){
		$('#username').val(null);
		$('#password').val(null);
		$('#passwordQd').val(null);
		$('#nickname').val(null);
		$('#email').val(null);
		$('#modalAdd').modal('show');
	})
	
	// 点击保存时 对输入的数据进行判断并存入
	$('#to-save').click(function(){
		var username = $('#username').val();
		var password = $('#password').val();
		var passwordQd = $('#passwordQd').val();
		var nickname = $('#nickname').val();
		var email = $('#email').val();
		
		var re=/^([a-z]|[0-9]){3,12}@([a-z]|[0-9]){2,10}\.[a-z]{3,5}$/ig;
		if(password == passwordQd){
			if(re.test(email)){
				var obj = {
					username:username,
					password:password,
					nickname:nickname,
					email:email
				}
				saveOrUpdateUser(obj);
				alert('保存成功');
				$('#modalAdd').modal('hide');
			}else{
				alert('邮箱格式错误,请重新输入');
				$('#email').val(null);
			}
			
		}else{
			alert('两次输入的密码不一致，请重新输入');
			$('#passwordQd').val(null);
		}
		
		
	})
	
	// 方法:保存数据
	function saveOrUpdateUser(obj){
		getAjax('manager/user/saveOrUpdateUser','post',obj,function(res){
			findAllUser();
		},function(error){})
	}
	
	// 向接口查询所有的数据
	function findAllUser(){
		$('.user').empty();
		getAjax('manager/user/findAllUser','get',null,function(res){
			// console.log(res.data);
			// 遍历拿到的数据  准备填充  
			res.data.forEach(function(item){
				// console.log(item);
				var key=item.enabled;
				// console.log(key);
				//根据值让option选中 
				// $("#myModal select").val(key+'');
				// console.log($("#myModal select").val());
				$('.user').append(`
					<div class="col-sm-4 model pull-left" id="myModal">
						<div class="thumbnail">
							<img style="width: 150px;height: 150px;" src="image/3.png" class="img-circle" alt="图片找不到了">
							<div class="caption">
								<div class="row">
									<div class="col-sm-4 col-sm-offset-1">用户名</div>
									<div class="col-sm-7">`+item.username+`</div>
								</div>
								<div class="row">
									<div class="col-sm-4 col-sm-offset-1">真实姓名</div>
									<div class="col-sm-7">`+item.nickname+`</div>
								</div>
								<div class="row">
									<div class="col-sm-4 col-sm-offset-1">注册时间</div>
									<div class="col-sm-7">`+item.regTime+`</div>
								</div>
								<div class="row">
									<div class="col-sm-4 col-sm-offset-1">email</div>
									<div class="col-sm-7">`+item.email+`</div>
								</div>
								<div class="row">
									<div class="col-sm-4 col-sm-offset-1">状态</div>
									<div class="col-sm-4 ">
										<select id="select" class="form-control" data-id="`+item.id+`">
											<option value="false" id="`+item.id+`">禁用</option>
											<option value="true" id="`+item.id+`">启用</option>
										</select>
									</div>
								</div>
								<div class="row col-sm-offset-4">
									<button type="button" class="btn btn-success" id="to-change" value="`+item.id+`">修改</button>
									<button type="button" class="btn btn-danger" id="to-delete" value="`+item.id+`">删除</button>
								</div>
							</div>
						</div>
					</div>
				`)
				$("#myModal select").last().val(key+'');
				// $("#myModal select option[value='"+key+"']").attr("selected","selected");
			});
		},function(error){});
	}
	
	
	
</script>